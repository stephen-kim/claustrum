# 모노레포 분할 정책

## 모드

`monorepo_context_mode`은 세 가지 모드를 지원합니다.

1. `shared_repo`(기본값)
2. `split_on_demand`
3. `split_auto`(고급)

## 비교

### `shared_repo`

- 활성 프로젝트 키는 저장소 수준(`github:owner/repo`)에 유지됩니다.
- 하위 경로는 순위/부스트를 위한 메타데이터로 유지됩니다.
- 운영 오버헤드가 가장 낮습니다.

### `split_on_demand`

- 명시적으로 나열된 하위 경로만 격리됩니다.
- 정책 출처: `monorepo_subproject_policies`.
- 목록에 없는 하위 경로는 저장소 수준 프로젝트에 남아 있습니다.
- 제작팀에게 권장되는 분할 전략.

### `split_auto`

- Resolver는 가드레일을 사용하여 `repo#subpath`을 자동으로 생성/사용할 수 있습니다.
- 더 공격적이고 편리하지만 더 많은 프로젝트를 만들 수 있습니다.
- 팀이 하위 경로별 자동 격리를 원하지 않는 한 이 기능을 꺼두세요.

## 주문형 분할이 기본 분할 전략인 이유

- 대규모 모노레포에서 우발적인 프로젝트 폭발을 방지합니다.
- 관리자에게 경계에 대한 명시적인 제어 권한을 부여합니다.
- 엄격한 분할이 필요하지 않은 경우 공유 컨텍스트를 계속 사용할 수 있습니다.

## 운영 가이드

1. `shared_repo`으로 시작하세요.
2. 하나 또는 두 개의 하위 경로를 격리해야 하는 경우 `split_on_demand`으로 전환합니다.
3. 격리할 정확한 하위 경로에 대한 정책을 추가합니다.
4. 워크플로우가 자동 확장을 허용하는 경우에만 `split_auto`을 사용하십시오.

## 정책 테이블

`monorepo_subproject_policies`

- `workspace_id`
- `repo_key`
- `subpath`
- `enabled`

`split_on_demand` 확인에는 활성화된 행만 사용됩니다.

## 해석기 동작 요약

- `shared_repo`:
  - 활성 프로젝트 = `repo_key`
- `split_on_demand`:
  - 정책 테이블에서 `(repo_key, subpath)`이 활성화된 경우:
    - 진행 중인 프로젝트 = `repo_key#subpath`
    - 누락된 경우 처음 사용할 때 프로젝트 생성
  - 그 외:
    - 진행 중인 프로젝트 = `repo_key`
- `split_auto`:
  - 기존 가드레일을 사용한 자동 분할 동작을 따릅니다.

## 이름 변경 처리

저장소/하위 경로 이름 변경 별칭 매핑은 향후 작업으로 계획되어 있습니다.
현재 권장 사항: 이전 항목을 일시적으로 유지하고 정책을 단계별로 마이그레이션합니다.